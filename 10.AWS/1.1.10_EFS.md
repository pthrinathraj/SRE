
# 1.1.10 Amazon Elastic File System (EFS) - Detailed Guide

## 1. What is Amazon EFS?
**Amazon Elastic File System (EFS)** is a fully managed, **scalable**, **shared file storage** service for use with Amazon EC2, containers (EKS, ECS), and Lambda. It provides a standard file system interface and file system access semantics, supporting the NFSv4 protocol.

EFS is ideal for workloads that require shared access to file data across multiple compute instances.

## 2. Key Features of EFS
- **Fully Managed**: No servers to provision or manage.
- **Scalable**: Grows and shrinks automatically as you add/remove files.
- **Concurrent Access**: Multiple EC2 instances can mount the same file system concurrently.
- **Durable and Available**: Data is stored across multiple AZs by default.
- **Performance Modes**:
  - **General Purpose** (default, low latency)
  - **Max I/O** (high throughput for large workloads)
- **Throughput Modes**:
  - **Bursting**: Based on size of stored data
  - **Provisioned**: Fixed throughput, independent of size
- **Security**: Integrated with IAM, supports encryption at rest and in transit

## 3. Use Cases
- Web serving and content management (CMS)
- Shared home directories for Linux/Unix workloads
- Big data analytics and machine learning
- Application backup and storage layer
- Media rendering or genomics pipelines

## 4. EFS vs EBS vs S3
| Feature        | EFS                        | EBS                        | S3                         |
|----------------|----------------------------|----------------------------|-----------------------------|
| Type           | File system                | Block storage              | Object storage              |
| Shared Access  | Yes                        | No                         | Yes (via API)               |
| Scalability    | Auto                       | Manual                     | Virtually unlimited         |
| Use Case       | Shared, Linux FS           | Databases, boot volumes    | Static assets, backups      |
| Access Method  | Mount via NFS              | Attach as a block device   | REST API / SDK              |

## 5. How to Create and Mount EFS

### Step 1: Create File System
- Go to **EFS Dashboard > Create file system**
- Choose VPC, availability zones, and subnets
- Enable encryption (optional)

### Step 2: Mount Targets
- AWS automatically creates mount targets in each AZ for HA

### Step 3: Mount on EC2 (Linux)
Install NFS client:
```bash
sudo yum install -y nfs-utils   # Amazon Linux
sudo apt install -y nfs-common  # Ubuntu
```

Mount the file system:
```bash
sudo mount -t nfs4 -o nfsvers=4.1 fs-xxxx.efs.us-east-1.amazonaws.com:/ /mnt/efs
```

To auto-mount on reboot, add to `/etc/fstab`:
```fstab
fs-xxxx.efs.us-east-1.amazonaws.com:/ /mnt/efs nfs4 defaults,_netdev 0 0
```

## 6. Pricing Considerations
- **Storage cost** per GB/month
- **Data transfer** within the same VPC is free
- **Provisioned throughput** adds additional cost
- **Infrequent Access (IA) tier** available for cost savings

## 7. Best Practices
- Use **Access Points** for simplified multi-user permissions
- Enable **IAM authorization** and encryption at rest/in transit
- Use **backup integration** with AWS Backup
- Consider **EFS Intelligent-Tiering** for cost optimization

## 8. Monitoring and Logging
- Use **Amazon CloudWatch** for metrics (latency, throughput, IOPS)
- **CloudTrail** for API usage auditing
- Enable **EFS Lifecycle Management** to move files to IA automatically

## 9. EFS with Other AWS Services
- **EC2**: Direct mount using NFS
- **EKS/ECS**: Use CSI driver for dynamic provisioning
- **Lambda**: Mount as persistent shared storage for large functions
- **AWS Backup**: Schedule and automate file system backups

---

**Last Updated:** March 30, 2025

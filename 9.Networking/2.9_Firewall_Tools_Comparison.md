
# 2.9 Firewall Rules and Packet Filtering â€“ Introduction

Firewalls are critical components in computer networks and operating systems that control the flow of network traffic. In Linux, the firewall is managed at the kernel level via a system called **netfilter**, and tools like `iptables`, `nftables`, or `firewalld` are used to interact with it.

---

## ðŸ”¥ What is a Firewall?

A firewall is a security system that monitors and controls incoming and outgoing network traffic based on predefined security rules.

### ðŸ“Œ Core Purposes:
- Block unauthorized access to services or ports
- Allow only trusted traffic based on rules
- Prevent data exfiltration
- Restrict lateral movement within internal networks

---

## ðŸ§± Linux Firewall Components

Linux firewalls rely on:

- **Netfilter:** The kernel subsystem that provides packet filtering capabilities.
- **iptables:** A user-space utility to configure packet filtering rules for netfilter.
- **nftables:** A modern replacement for iptables, with a more consistent and flexible rule syntax.
- **firewalld:** A high-level daemon that manages firewall rules dynamically using zones and services (uses iptables or nftables underneath).

---

## ðŸ”„ Packet Flow and Filtering Chains

Netfilter uses 5 primary chains for processing traffic:

| Chain        | Applies To                      |
|--------------|----------------------------------|
| INPUT        | Incoming traffic destined for the local system |
| OUTPUT       | Outbound traffic generated by the local system |
| FORWARD      | Traffic routed through the system (not local) |
| PREROUTING   | Modify packets before routing decisions |
| POSTROUTING  | Modify packets after routing decisions |

---

## ðŸ§  Rule Match Criteria

Firewall rules typically filter traffic based on:

- **Source/destination IP**
- **Protocol (TCP/UDP/ICMP)**
- **Port number (e.g., 22 for SSH, 80 for HTTP)**
- **Interface (e.g., eth0, wlan0)**
- **Connection state (NEW, ESTABLISHED)**

---

## âœ… Benefits of Using a Firewall

- **Improved security**: Reduces attack surface
- **Traffic control**: Permit or deny specific traffic
- **Visibility**: Log attempted connections
- **Compliance**: Enforce security policies

---
# Firewall Tools in Linux â€“ iptables vs firewalld

This document explains the difference between two major Linux firewall tools: `iptables` and `firewalld`, including when and why you would use each.

---

## ðŸ”¥ What is iptables?

`iptables` is a **low-level command-line utility** used to configure the Linux kernel's **netfilter** firewall. It allows manual rule definition for controlling network traffic.

### ðŸ”¹ Key Features:
- Fine-grained control
- Rule-based structure
- Supports packet filtering, NAT, and more
- Ideal for scripting and custom setups

### ðŸ”¹ Example Command:
```bash
sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
```
> This rule accepts incoming TCP traffic on port 22 (SSH).

---

## ðŸ”¥ What is firewalld?

`firewalld` is a **high-level firewall management tool** that configures iptables (or nftables) rules behind the scenes. It introduces **zones** and **services** to simplify configuration.

### ðŸ”¹ Key Features:
- Dynamic rule management
- Zone-based configuration
- Built-in support for services (e.g., http, ssh)
- Easily enables/disables ports and protocols

### ðŸ”¹ Example Command:
```bash
sudo firewall-cmd --add-port=22/tcp --permanent
sudo firewall-cmd --reload
```
> Opens port 22 permanently and reloads firewall configuration.

---

## ðŸ¤” Why Two Tools?

While both control the same firewall framework (netfilter), they differ in **interface** and **complexity**.

| Feature            | iptables                          | firewalld                          |
|--------------------|------------------------------------|------------------------------------|
| Layer              | Low-level                         | High-level abstraction             |
| Ease of Use        | Requires deeper understanding      | Easier with zones and services     |
| Rule Persistence   | Manual (`iptables-save`)           | Built-in permanent mode            |
| Dynamic Rules      | Requires scripting                 | Built-in dynamic runtime changes   |
| Use Case           | Precise, scripted environments     | Desktop/server user friendliness   |

---

## ðŸ§  TL;DR â€“ When to Use What?

| Use Case                                | Recommended Tool |
|-----------------------------------------|------------------|
| You're writing custom firewall scripts  | `iptables`       |
| You want a quick way to open a port     | `firewalld`      |
| You're managing a RHEL/Fedora system    | `firewalld`      |
| You need to log, tweak, and track rules | `iptables`       |

---

## ðŸ›  Under the Hood

- `firewalld` builds iptables or nftables rules under the hood.
- You can use `iptables -L` to inspect what firewalld has generated.

---

## âœ… Summary

Use `iptables` for full control and scripting. Use `firewalld` for faster, simpler configuration â€” especially when zone-based policies and runtime management are preferred.


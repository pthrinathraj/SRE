# 2.6 DHCP in Practice â€“ In-Depth Guide
# ðŸ“¡ DHCP Process â€“ Dynamic Host Configuration Protocol

This document explains the **DHCP process** used to automatically assign IP addresses and network configuration to clients on a network.

---

## ðŸ§  What is DHCP?

**DHCP** (Dynamic Host Configuration Protocol) is a client/server protocol that automatically provides IP addresses, subnet masks, default gateways, and DNS servers to network devices.

---

## ðŸ”„ DHCP DORA Process

The process includes **four main steps**, known as **DORA**:

| Step     | Description                                                                 |
|----------|-----------------------------------------------------------------------------|
| ðŸ” **Discover** | Client broadcasts `DHCPDISCOVER` to find available DHCP servers.         |
| ðŸ“¢ **Offer**     | Server replies with `DHCPOFFER`, suggesting an IP address and config.   |
| âœ… **Request**   | Client sends `DHCPREQUEST`, indicating it wants the offered config.     |
| ðŸ“¨ **Acknowledge** | Server responds with `DHCPACK`, confirming lease of IP and settings.    |

---


## ðŸ§ª 2. View Current IP and Lease Information

### ðŸ”¹ Check IP address:
```bash
ip addr show
```

### ðŸ”¹ Check default route and DNS:
```bash
ip route show
cat /etc/resolv.conf
```

### ðŸ”¹ DHCP lease file:
```bash
cat /var/lib/dhcp/dhclient.leases
```

### ðŸ§  Interpretation:
- Shows active and historical lease details including expiration, DNS, and gateway.

---

## ðŸ”§ 3. Renew or Release a DHCP Lease

### ðŸ”¹ Release IP:
```bash
sudo dhclient -r
```

### ðŸ”¹ Request new IP:
```bash
sudo dhclient
```

### ðŸ“¤ Sample Output:
```
DHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 4
DHCPOFFER from 192.168.1.1
DHCPREQUEST on eth0 to 255.255.255.255 port 67
DHCPACK from 192.168.1.1
bound to 192.168.1.100 -- renewal in 3600 seconds.
```

### ðŸ§  Interpretation:
- Each step of DORA is shown
- Final `bound` line confirms the lease

---

## ðŸ” 4. Analyze DHCP Traffic with tcpdump

```bash
sudo tcpdump -i eth0 port 67 or port 68 -n
```

### ðŸ“¤ Output:
```
12:15:10.123456 IP 0.0.0.0.68 > 255.255.255.255.67: BOOTP/DHCP, Request from 08:00:27:1a:2b:3c
```

### ðŸ§  Interpretation:
- Port 67 = DHCP server
- Port 68 = DHCP client
- MAC address shown in requests

---

## ðŸŽ¯ 5. Common Troubleshooting Scenarios

| Symptom | Likely Cause | Resolution |
|---------|--------------|------------|
| IP stuck in `169.254.x.x` | DHCP server not reachable | Check cable, switch, firewall |
| DHCP timeout | Firewall blocks UDP 67/68 | Allow DHCP traffic |
| Receives wrong DNS or gateway | Misconfigured DHCP server | Inspect `/etc/resolv.conf` or lease file |

---

## âœ… Summary Table

| Task | Command | Notes |
|------|---------|-------|
| Release IP | `sudo dhclient -r` | Sends DHCPRELEASE |
| Renew IP | `sudo dhclient` | Triggers DORA cycle |
| View lease file | `cat /var/lib/dhcp/dhclient.leases` | Historical leases |
| Monitor traffic | `tcpdump port 67 or 68` | Inspect DHCP packets |

---

This concludes **2.6 â€“ DHCP in Practice**. Next: 2.7 â€“ Troubleshooting Scenarios.

## ðŸ§± Additional DHCP Messages

- **DHCPNAK** â€“ Sent by server if request is invalid or IP is unavailable.
- **DHCPRELEASE** â€“ Sent by client to return the IP before lease expires.
- **DHCPINFORM** â€“ Sent by client to obtain config settings without IP.

---

## â³ DHCP Lease

- IPs are assigned for a specific **lease time** (e.g., 24 hours).
- Clients must renew the lease before it expires or request a new one.

---

## ðŸ” DHCP Packet Flow

```text
Client                                Server
   |   ----------- DHCPDISCOVER --------->   |
   |   <------------ DHCPOFFER --------------   |
   |   ----------- DHCPREQUEST ------------>   |
   |   <------------ DHCPACK ----------------   |

